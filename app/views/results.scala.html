@(query: Query, answers: AnswerSet, filters: Set[TypeFilter], filterString: String, pageno: Int, pageCount: Int, maxSentenceCount: Int, debug: Boolean)

@import helper.twitterBootstrap._
@import edu.washington.cs.knowitall.browser.extraction.ExtractionGroup

<br/>
@if(answers.filters.size > 0) {
  <ul class="nav nav-tabs">
    <li class="@{if(filters.isEmpty) "active" else ""}"><a href="#all" onclick="tabto('@{routes.Application.results(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), "all", 0)}')">all</a></li>
@for((filter, count)<-answers.filters.sortBy(-_._2)) {
  @defining(filters.contains(filter)) { active =>
    <li class="@{if(active) "active" else ""}"><a href="#@filter.typ.typ" onclick="tabto('@{routes.Application.results(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), filter.typ.name, 0)}')">@filter.displayName (@count)</a></li>
  }
}
    <li class="@{if(filterString == "other") "active" else ""}"><a href="#other" onclick="tabto('@{routes.Application.results(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), "other", 0)}')">other</a></li>
  </ul>
}

  <div style="height: 25px"></div>

  <div class="tabbable tabs-left">
    <ul class="nav nav-tabs">
      @for((g, i) <- answers.groups.zipWithIndex) {
      <li><a href="#L@{i}" class="answer" data-toggle="tab">@helper.grouptitle(g.title, debug) (@g.contents.size)</a></li>
      }
    </ul>
    <div class="tab-content">
      @for((g, i) <- answers.groups.zipWithIndex) {
      <div class="tab-pane" id="L@{i}">
        <span class="close-tab"><a href="#close@{i}" class="close-tab" title="close sentences"><i class="icon-remove"></i></a></span>
        @helper.sentences(g.copy(contents=g.contents.take(maxSentenceCount)))
        @if(g.contents.size > maxSentenceCount) {
          <p style="text-align: center"><a href="@{routes.Application.sentences(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), g.title.text)}">Show all sentences (@{g.contents.size - maxSentenceCount} more)</a></p>
        }
      </div>
      }
    </div>
  </div> <!-- /tabbable -->
    <!-- Pagination -->
@if(pageCount > 1) {
    <div class="pagination" align="center">
        <ul>
@if(pageno > 0) {
            <li><a href="@{routes.Application.search(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), filterString, pageno - 1)}">Prev</a></li>
}
@for(i <- pageno-4 to pageno-1; if i >= 0) {
            <li><a href="@{routes.Application.search(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), filterString, i)}">@i</a></li>
}
            <li class="active">
            <a href="#">@pageno</a>
            </li>
@for(i <- pageno+1 to pageno+4; if i < pageCount) {
            <li><a href="@{routes.Application.search(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), filterString, i)}">@i</a></li>
}
@if(pageno + 1 < pageCount) {
            <li><a href="@{routes.Application.search(query.arg1.map(_.toString), query.rel.map(_.toString), query.arg2.map(_.toString), filterString, pageno + 1)}">Next</a></li>
}
        </ul>
    </div>
}

    <div style="height: 60px"></div>
    <div class="freebase-attribution">
        <img alt="Freebase CC-BY" height="23px" style="border: 0;" width="61px" src="http://www.freebase.com/policies/freebase-cc-by-61x23.png"/>
        <div style="font-size: x-small; height: 30px; ">
            Source:
            <a href="http://www.freebase.com/">Freebase</a>, licensed under
            <a href="http://creativecommons.org/licenses/by/2.5/">CC-BY</a><br/>
            Other content from
            <a href="http://en.wikipedia.org/">Wikipedia</a>,
            licensed under <a href="http://creativecommons.org/licenses/by-sa/2.5/">CC BY-SA</a>
        </div>
    </div>

    <script type="text/javascript">
    $.extend({
  getUrlVars: function(){
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
      hash = hashes[i].split('=');
      vars.push(hash[0]);
      vars[hash[0]] = hash[1];
    }
    return vars;
  },
  getUrlVar: function(name){
    return $.getUrlVars()[name];
  }
});

      var download_popover = function() {
        // this refers to a different object in 
        // a nested anonymous function
        var span = this

        // we don't want to run this particular action again,
        // but we don't want to remove all hover actions
        $(span).unbind('hover', download_popover)

        $.getJSON("https://www.googleapis.com/freebase/v1/text/m/"+span.id+'?format=plain&lang=en&maxlength=200&callback=?', function(response) {
          var src = 'https://usercontent.googleapis.com/freebase/v1/image/m/'+span.id+'?maxheight=75&maxwidth=75'
          $(span).attr('data-content', function(index, attr) { 
            return '<img class="popover-image" src="'+src+'">' + '<span class="popover-desc">'+response.result+"</span>" + '<div style="height: 10px"></div>'+attr
          })

          var image = new Image()
          image.src = src
        })
      }

      $('.title-string').popover({ delay: { show: 1000, hide: 100 }})

      $('.title-entity').popover({ delay: { html: true, show: 1000, hide: 100 }})
      $('.title-entity').hover(download_popover)

      $('.close-tab').click(function() {
        var $active = $('.tab-content').find('> .active')
        $active.removeClass('active')
      })
    </script>