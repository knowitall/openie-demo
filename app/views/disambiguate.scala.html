@(query: Query, answers: AnswerSet, filters: Set[TypeFilter], filterString: String, pageno: Int, pageCount: Int, maxSentenceCount: Int, debug: Boolean)

@import helper.twitterBootstrap._
	
	<!-- print out all queryEntities -->
	<!-- if the query is a linked entity, insert a knowledge card about it -->
	 
	@list = @{
    	List.range(0, answers.queryEntities.size)
	} 
	
		@for(s <- answers.queryEntities){
		    Html("<div class='row'>")
		    Option(s._1) match {
	          case Some(fbe) => Html("<div id='query-card-@list(0)' class='offset1 span10' data-attr='"+fbe.fbid+"'><h3>"+fbe.name+"</h3><div id='query-card-spinner'></div></div>")
	          case None => ""
	        }
		    Html("</div><br/>")
		    @list = @{list.patch(0, Nil, 1)}
		}
	
	
	
	
<script type="text/javascript">
// spinner options presets
var smallSpinnerOpts = {lines: 9, length: 0, width: 4, radius: 6, rotate: 0, color: '#000', speed: .95, trail: 60, shadow: false, hwaccel: false, className: 'spinner', zIndex: 2e9, top: 'auto', left: 'auto'};
var spinnerOpts = {lines: 9, length: 0, width: 15, radius: 30, rotate: 0, color: '#000', speed: .95, trail: 60, shadow: false, hwaccel: false, className: 'spinner', zIndex: 2e9, top: 'auto', left: 'auto'};

$.extend({
	getUrlVars: function(){
		var vars = [], hash;
		var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');

		for(var i = 0; i < hashes.length; i++) {
			hash = hashes[i].split('=');
			vars.push(hash[0]);
			vars[hash[0]] = hash[1];
		}

		return vars;
	},

	getUrlVar: function(name){
		return $.getUrlVars()[name];
	}
});

// create a tab-pane knowledge card from FreeBase information
var download_freebase = function(id, fbid, partIndex, spin) {
	var datacontent = "";
	
	// hide all the tab content, so that it will all appear at once
	// otherwise it appears piecewise, which is jarring
	$(".tab-content").hide();

	// set image src to freebase entity
	var src = 'https://usercontent.googleapis.com/freebase/v1/image/m/'+ fbid + '?maxheight=150&maxwidth=150';
	
	// attempt to preload images
	try {
		var image = new Image();
		image.src = src;
	} catch(e) {}

	// throw up a spinner while we're querying freebase
	if (spin) {
		$("#tab-spinner").show();
		$("#tab-spinner").spin(spinnerOpts);
	}
	
	// get freebase entity information as JSON object
	$.getJSON("https://www.googleapis.com/freebase/v1/text/m/" + fbid + '?format=plain&lang=en&maxlength=1000&callback=?', function(response) {
		if (response !== undefined && response.result !== undefined) {
			// populate entity data from freebase
			datacontent = '<div class="entity-desc">'
				+ '<img src="' + src + '">'
				+  '<p>' + $('<div/>').text(response.result).html()
				+ ' <a href="http://www.freebase.com/view/m/' + fbid + '">(read more)</a>' + '</p>'
				+ '</div>';
		} else {
			// if there is no freebase information, create an empty entity-desc
			datacontent = '<div class="entity-desc"></div>';
		}
	
		// insert the entity description into the tab-pane
		$(datacontent).insertAfter($(id + ">#E" + partIndex + ">h2"));

		// stop the spinner and
		// show tab content again
		if (spin) {
			$("#tab-spinner").data("spinner").stop();
			$(".tab-content").show();
		    $("#tab-spinner").hide();
	    }
	})
}

// a spinner that triggers on tab switch
// calls the bootstrap function that switches tabs
var tabSpin = function(params) {
	$("#tab-spinner").spin(spinnerOpts);
	tabto(params);
}

// populate knowledge card information for the query entity
// only triggers if the query is for a known entity
// run before $(document).ready to improve speed


if ( $("#query-card").length == 1 ) {
	// make sure we only have one
	if ( $("#query-card-content").length == 0 ) {	
		// start a spinner
		$("#query-card-spinner").show();
		$("#query-card-spinner").spin(spinnerOpts);

		var id = $("#query-card").attr("data-attr");

		var src = 'https://usercontent.googleapis.com/freebase/v1/image/m/'+id+'?maxheight=150&maxwidth=150'
		
		// attempt to preload images
		try {
			var image = new Image();
			image.src = src;
		} catch(e) {}

		// pull freebase entity information as JSON object
		$.getJSON("https://www.googleapis.com/freebase/v1/text/m/"+id+"?format=plain&lang=en&maxlength=1000&callback=?", function(response) {
			if (response != undefined && response.result != undefined) {
				// stop spinner
				$("#query-card-spinner").data("spinner").stop();
				$("#query-card-spinner").hide();

				$("#query-card").append("<div id='query-card-content'><img src=\"https://usercontent.googleapis.com/freebase/v1/image/m/"+id+"?maxheight=150&maxwidth=150\">");
				$("#query-card").append(response.result + "<a href=\"http://www.freebase.com/view/m/" +id+ "\">read more</a></div>");
			}
		})
	}
}

$(document).ready(function() {
	// grab freebase id (if possible) on click
	$('.answer').click(function() {
		var id = $(this).attr("href");
		var fbids = $(this).attr("data-fbid");

		// make sure there is actually a FreeBase ID
		// and that we don't already have the FB info
		if (fbids != "" &&  fbids !== undefined) {
			$.each(fbids.split(";"), function(index, fbid) {
				if ($(id+'>#E' + index + '>.entity-desc').length == 0) {
					download_freebase(id, fbid, index, index == 0);
				}
			});
		}
	});

	$(".entity-link").click(function() {
		$("#tab-spinner").spin(spinnerOpts);
	})

	$('.close-tab').click(function() {
		$('.tab-pane.active').removeClass('active');
		$(".tabbable.tabs-left").find(".active").removeClass("active");
	})

	$(".btn").click(function() {
		$("#tab-spinner").spin(spinnerOpts);
	});
		
	$('#moreDropdown').click(function (e) {
		e.preventDefault();
		$(this).tab('show');
	})
})
</script>