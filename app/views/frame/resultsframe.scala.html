@(searchForm: Form[Query], query: Query, message: Option[String], answers: AnswerSet, totalAnswerCount: Int, totalSentenceCount: Int, isResults : Boolean, isPPFiltered: Boolean)(content: Html)

@import helper.twitterBootstrap._
@import edu.knowitall.paraphrasing.Paraphrase

@renderParaphrase(pp: Paraphrase) = {
  @{pp.target(0).toUpper + pp.target.drop(1).replaceAll(" be ", " is ").replaceAll("\\s\\?$", "?")}
}

@helper.main("Open Information Extraction", compact=true) {

  <div class="row well">
  <div class="col-md-6 col-md-offset-3">
        @helper.form(action = routes.Application.submit(false)) {
        <label for="question">Question:&nbsp;</label>
        <div class="input-group input-group-lg search-arg">
          <input type="text" id="question" name="question" value="@{query.question}" autocomplete="off" class="form-control">
          <span class="input-group-btn">
            <button id="search-	button" class="btn btn-primary"><i id="search-icon" class="glyphicon glyphicon-search"></i> Search</button>
          </span>
        </div>  
        }
        </div>
  </div> 
    
  @if(answers.paraphraseHits.nonEmpty && !isPPFiltered) {
  <div class="row">
    <b>Top paraphrases:</b>
    <div class="panel-group" id="pp-accordion">
      <div class="panel panel-default">
        
          <div class="panel-title list-group-item">
            <table style="width:100%;"><tr>
            @for(group <- answers.paraphraseHits.grouped(3).toSeq.take(1); ((pp, count), ppIndex) <- group.zipWithIndex) {
              <td align="center">
              <a href='@{routes.Application.results(query.question, query.parserName, "all", 0, Some(ppIndex), false, false)}'>
              @renderParaphrase(pp)
              </a>
              <span class="text-muted" style="font-size:small;">(@count answers)</span></td>
            }
            </tr></table>
          </div>
        
        <div id="pp-collapse" class="panel-collapse collapse">
          @for((group, ppgIndex) <- answers.paraphraseHits.grouped(3).toSeq.drop(1).zipWithIndex) {
            <div class="list-group-item">
              <table style="width:100%;"><tr>
              @for(((pp, count), ppIndex) <- group.zipWithIndex) {
                <td align="center">
                <a href='@{routes.Application.results(query.question, query.parserName, "all", 0, Some(ppIndex + (ppgIndex * 3) + 3), false, false)}'>
                @renderParaphrase(pp) 
                <span class="text-muted" style="font-size:small;">(@count answers)</span>
                </a>
                </td>
              }
              </tr></table>
            </div>
          }
        </div>
      </div>
    </div>
    @if(answers.paraphraseHits.grouped(3).size > 1){
      <div class="row" style="height:10px;">
      <div style="width:100px;float:none;margin:auto;">
        <div class="list-group">
          <a id="pp-more" class="list-group-item accordion-toggle" data-toggle="collapse" data-parent="#pp-accordion" href="#pp-collapse" style="border-top:0px;padding:3px 7px 3px 7px;text-align:center;border-top-left-radius:0px;border-top-right-radius:0px;">
            @{answers.paraphraseHits.size - 3}&nbsp;<span id="pp-text">more</span>&nbsp;<i id="pp-icon" class="glyphicon glyphicon-arrow-down text-muted" style="top:3px;"></i>
          </a>
        </div>
      </div>
      </div>
    }
  </div>
  } else {
    @if(isPPFiltered) {
      <div>Displaying results for paraphrase &quot;<span style="font-weight:bold;">@renderParaphrase(answers.paraphraseHits.head._1)</span>&quot;&nbsp;
      <a href='@{routes.Application.results(query.question, query.parserName, "all", 0, None, false, false)}'>
      View results from all paraphrases
      </a>
      </div>
    } else {
      <div class="text-muted">No paraphrases found.</div>
    }
  }
     
  <div class="stats"><b>@totalAnswerCount answers</b> from <b>@totalSentenceCount sentences</b> in <b>@{answers.sourcesCount} sources</b>@message.map(" ("+_+")").getOrElse("")</div>
    
  <!-- Display the query card if its the results frame for results page -->
      
  <div id="results-content">
      @content
  </div>

  <!-- freebase attr footer -->
  <div class="freebase-attribution">
    <img alt="Freebase CC-BY" height="23px" style="border: 0;" width="61px" src="http://www.freebase.com/policies/freebase-cc-by-61x23.png"/>
  
    <div>
      <p>Source: <a href="http://www.freebase.com/">Freebase</a>, licensed under <a href="http://creativecommons.org/licenses/by/2.5/">CC-BY</a></p>
      <p>Other content from <a href="http://en.wikipedia.org/">Wikipedia</a>, licensed under <a href="http://creativecommons.org/licenses/by-sa/2.5/">CC BY-SA</a></p>
    </div>
  </div>
  <!-- /freebase attr footer --> 

  <script type="text/javascript">
			function tabto(dest) {
				$.ajax(dest).done(function(html) {
					$('#results-content').html(html);
				})
			}
			
  $('#pp-collapse').on('hide.bs.collapse', function () {
    $('#pp-text').html("more");
    $('#pp-icon').toggleClass("glyphicon-arrow-up");
    $('#pp-icon').toggleClass("glyphicon-arrow-down");
  });
  
  $('#pp-collapse').on('show.bs.collapse', function () {
    $('#pp-text').html("less");
    $('#pp-icon').toggleClass("glyphicon-arrow-up");
    $('#pp-icon').toggleClass("glyphicon-arrow-down");
  });
			
		</script>
}
